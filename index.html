<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <title>What's the Cost?</title>

  <!-- Styles -->
  <style>
    :root{
      --bg:#f7f7f7;
      --card:#ffffff;
      --text:#222;
      --muted:#666;
      --primary:#329926;
      --primary-hover:#26731c;
      --border:#e6e6e6;
      --shadow:0 8px 24px rgba(0,0,0,0.06);
    }

    html,body{ background:var(--bg); }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      max-width: 860px;
      margin: 40px auto;
      padding: 0 20px 40px;
      color: var(--text);
      line-height: 1.6;
    }

    h1{ font-size: 26px; margin: 6px 0 18px; }
    h2{ margin: 22px 0 10px; }
    h3{ margin: 16px 0 8px; color: var(--muted); font-weight:600; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 18px 18px 22px;
      margin-top: 16px;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:14px 18px;
      align-items:center;
      margin: 8px 0 4px;
    }

    label{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-weight:600;
    }

    input[type="number"], input[type="text"]{
      padding: 10px 12px;
      font-size: 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background:#fff;
      width: 160px;
    }

    input[type="text"]{ width: 300px; max-width: 100%; }

    button{
      padding: 10px 16px;
      font-size: 15px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform .02s ease, background .15s ease;
    }
    button:hover{ background: var(--primary-hover); }
    button:active{ transform: translateY(1px); }

    .btn-secondary{
      background:#e9e9e9;
      color:#111;
    }

    .result{
      margin-top: 14px;
      font-size: 18px;
    }

    .gain-badge{
      display:inline-block;
      font-size: 13px;
      padding: 4px 8px;
      border-radius: 999px;
      margin-top: 6px;
      background: #e9f6ec;
      color: #145a1a;
      border:1px solid #cfe8d3;
      font-weight:600;
    }
    .loss-badge{
      background: #fdeaea;
      color:#7a1b1b;
      border:1px solid #f5c8c8;
    }

    hr{ border:0; border-top:1px solid var(--border); margin:18px 0; }

    table{
      width:100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 14px;
    }
    th, td{
      padding:10px 8px;
      border-bottom:1px solid var(--border);
    }
    thead th{
      font-weight:700;
      color:#444;
      background:#fafafa;
    }
    tbody tr:nth-child(even){ background:#fcfcfc; }
    tbody tr:hover{ background:#f5f7f5; }
    td:last-child{ width: 1%; white-space: nowrap; }

    @media (max-width: 520px){
      .row{ gap:10px 12px; }
      input[type="number"]{ width: 130px; }
    }
  </style>
</head>
<body>

 <h1>What's the Cost?</h1>

  <div class="card">
    <p>Enter a purchase amount and see what it would be worth if invested instead.</p>

    <div class="row">
      <label>Purchase (€)
        <input type="number" id="purchase" placeholder="e.g. 100" />
      </label>

      <label>Years
        <input type="number" id="years" value="10" />
      </label>

      <label>Annual interest (%)
        <input type="number" id="rate" value="5" />
      </label>

      <button onclick="calculate()">Calculate</button>
    </div>

    <div id="result" class="result"></div>
  </div>

  <div class="card">
    <h2>Investment Pot</h2>

    <div class="row">
      <label>Pot annual rate (%)
        <input type="number" id="potRate" value="5" />
      </label>

      <label>Note (optional)
        <input type="text" id="potNote" placeholder="e.g. Skipped hotel night" />
      </label>

      <button type="button" onclick="addToPotFromCalculator()">➕ Add current purchase to pot</button>
    </div>

    <small style="display:block;margin-top:6px;color:#666;">
      Tip: to record a withdrawal, enter a negative purchase (e.g. <strong>-50</strong>) and click the button.
    </small>

    <h3 style="margin-top:14px;">Pot entries</h3>
    <table id="potTable">
      <thead>
        <tr>
          <th style="text-align:left;">Date</th>
          <th style="text-align:right;">Amount</th>
          <th style="text-align:left;">Note</th>
          <th style="text-align:right;">Value Today</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="potBody"></tbody>
    </table>

    <h3 id="potTotal" style="margin-top:14px;"></h3>
  </div>

  <!-- Script -->
  <script>
    // Shared currency formatter
    const fmt = new Intl.NumberFormat('es-ES', { style:'currency', currency:'EUR' });

    // ---------- Calculator ----------
    function calculate() {
      const purchase = parseFloat(document.getElementById('purchase').value);
      const years = parseInt(document.getElementById('years').value);
      const rate = parseFloat(document.getElementById('rate').value) / 100;

      if (isNaN(purchase) || purchase === 0) {
        document.getElementById('result').textContent = "⚠️ Please enter a non-zero purchase amount (use negative for withdrawal).";
        return;
      }
      if (isNaN(years) || years < 0 || isNaN(rate) || rate < 0) {
        document.getElementById('result').textContent = "⚠️ Please enter valid years and interest.";
        return;
      }

      // FV = PV * (1 + r)^t
      const futureValue = purchase * Math.pow(1 + rate, years);
      const gain = futureValue - purchase;
      const returnPercent = (gain / Math.abs(purchase)) * 100;

      const badgeClass = gain >= 0 ? 'gain-badge' : 'gain-badge loss-badge';
      const badgeText  = `${gain >= 0 ? 'Gain' : 'Loss'}: ${fmt.format(gain)} • ${returnPercent.toFixed(1)}% total`;

      document.getElementById('result').innerHTML =
        `If invested, ${fmt.format(purchase)} could grow to ${fmt.format(futureValue)} in ${years} years at ${(rate*100).toFixed(1)}% interest.<br>
         <span class="${badgeClass}">${badgeText}</span>`;
    }

    // Enter key triggers Calculate
    ['purchase','years','rate'].forEach(id=>{
      const el = document.getElementById(id);
      el && el.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ calculate(); }});
    });

    // ---------- Investment Pot ----------
    const POT_KEY = 'oc_pot_entries_v1';

    function loadPot(){
      try{ const raw = localStorage.getItem(POT_KEY); return raw ? JSON.parse(raw) : []; }
      catch(e){ return []; }
    }
    function savePot(entries){ localStorage.setItem(POT_KEY, JSON.stringify(entries)); }

    // Compound from entry date to today
    function valueToday(entry, annualRate){
      const start = new Date(entry.date);
      const today = new Date();
      const days = (today - start) / 86400000; // ms → days
      const t = Math.max(0, days) / 365;
      const r = (annualRate||0) / 100;
      return entry.amount * Math.pow(1 + r, t);
    }

    function renderPot(){
      const entries = loadPot();
      const tbody   = document.getElementById('potBody');
      const potRate = parseFloat(document.getElementById('potRate').value) || 0;

      tbody.innerHTML = '';
      let total = 0;

      entries.forEach((e, idx)=>{
        const val = valueToday(e, potRate);
        total += val;

        const tr = document.createElement('tr');

        const tdDate = document.createElement('td');
        tdDate.textContent = new Date(e.date).toLocaleDateString('es-ES');
        tr.appendChild(tdDate);

        const tdAmt = document.createElement('td');
        tdAmt.style.textAlign='right';
        tdAmt.textContent = fmt.format(e.amount);
        tr.appendChild(tdAmt);

        const tdNote = document.createElement('td');
        tdNote.textContent = e.note || '';
        tr.appendChild(tdNote);

        const tdVal = document.createElement('td');
        tdVal.style.textAlign='right';
        tdVal.textContent = fmt.format(val);
        tr.appendChild(tdVal);

        const tdDel = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = 'Delete';
        btn.className = 'btn-secondary';
        btn.onclick = ()=>{
          const updated = loadPot().filter((_,i)=> i!==idx);
          savePot(updated);
          renderPot();
        };
        tdDel.appendChild(btn);
        tr.appendChild(tdDel);

        tbody.appendChild(tr);
      });

      document.getElementById('potTotal').textContent =
        `Total pot value today: ${fmt.format(total)} (at ${(potRate||0).toFixed(2)}% p.a.)`;
    }

    function addToPotFromCalculator(){
      const amount = parseFloat(document.getElementById('purchase').value);
      if (isNaN(amount) || amount === 0) {
        alert('Enter a non-zero purchase amount first (use negative for withdrawal).');
        return;
      }
      const note = document.getElementById('potNote').value.trim();
      const entries = loadPot();
      entries.push({ amount, date:new Date().toISOString(), note });
      savePot(entries);
      document.getElementById('potNote').value = '';
      renderPot();
    }

    // Init
    window.addEventListener('DOMContentLoaded', ()=>{
      renderPot();
      const pr = document.getElementById('potRate');
      pr && pr.addEventListener('input', renderPot);
    });
  </script>
</body>
</html>